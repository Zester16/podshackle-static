<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>PodShackle</title>
	<style>
		body{
			margin:0;
			
		}
		#header{
			display: flex;
			width: 0 auto;
			background-color:#7FFF00;
		}
		#body {
			margin-top: 10px;
			text-align: center;
			align-items: center;
		}

		#footer{
			position: fixed;
			bottom: 0%;
			width: 100%;
		}
		#podcast_player{
			padding:10px;
		}
		#brand_logo{
			width:max-content;
			height:60px;
		}
		#meter { 
			height: 20px;
			width: 90%;
			position: relative;
			background: #555;
			border-radius: 25px;
			padding: 10px;
			box-shadow: inset 0 -1px 1px rgba(255, 255, 255, 0.3);
		}
			#meter > span {
			display: block;
			height: 100%;
			border-top-right-radius: 8px;
			border-bottom-right-radius: 8px;
			border-top-left-radius: 20px;
			border-bottom-left-radius: 20px;
			background-color: rgb(43,194,83);
			background-image: linear-gradient(
				center bottom,
				rgb(43,194,83) 37%,
				rgb(84,240,84) 69%
			);
			box-shadow: 
				inset 0 2px 9px  rgba(255,255,255,0.3),
				inset 0 -2px 6px rgba(0,0,0,0.4);
			position: relative;
			overflow: hidden;
			}

		/* #audio_player {
			visibility: hidden;
		} */
	</style>
	<script>

	</script>
</head>

<body>
	<div id="header">
		<img src="./src/podshackle_2.webp" id="brand_logo"/>
	</div>
	<div id="body">
		
		<div id="version">
		</div>
	</div>
	<div id="footer">
		<div id="meter">
			<span id="progress_bar"></span>
		</div>
			
		<div id="podcast_player">
			<div id="current_time"></div>
		</div>
		<div><button id="play_button">Play</button></div>
	</div>

	<div id="player">
		<audio id="audio_player" controls>
			<source id="audio_player">
		</audio>
	</div>

	<script src="./scripts/podcastpull.js" ></script>
	<script>
		// initiates function using scoping
		setVersion()
		const podcastList=getPodcastDataXML()
		console.log("at main page",podcastList)
		const idObject = {meter:"meter",progressBar:"progress_bar",playButton:"play_button"}
		const meter = document.getElementById("meter")
		const progressBar = document.getElementById("progress_bar")
		const playButton = document.getElementById(idObject.playButton)
		
		// music player class
		class PodcastPlayer {

			player = document.getElementById("audio_player")
			audioTime = document.getElementById("current_time")
			progressBar = document.getElementById("progress_bar")
			src = null
			playtime = null

			setSrc(inputSrc) {
				this.player.src = inputSrc
				this.src = inputSrc
				this.play()
			}
			play() {
				this.player.play()
				this.#setPlayerDisplayTime()
			}
			
			setPlayerTime(percentage){
				this.player.currentTime = (this.#getPlayTime()*percentage)/100
				this.player.play()
			}
			//auxilary private functions accessible only for class
			#setPlayerTimeString(currentTime){
				const currentTimeInSeconds =currentTime/60 
				const minutes = Math.trunc(currentTimeInSeconds)
				const seconds = Math.trunc(currentTime%60)
				return `${minutes}:${seconds}` 
			}
			//gets current playtime from media players
			#getCurrentTime() {
				return this.player.currentTime
			}
			//gets total play time from media player
			#getPlayTime(){
				return this.player.duration
			}
			//sets playtime
			#setPlayerDisplayTime() {
				this.playerTimeId = setInterval(() => {
				//const currentTime =this.getCurrentTime()
				const getTimeP = (this.#getCurrentTime()/this.#getPlayTime())*100
				this.progressBar.style.width = `${getTimeP}%`
				const currentPlaytime=this.#setPlayerTimeString(this.#getCurrentTime())
					this.audioTime.innerHTML = `${currentPlaytime} / ${this.#setPlayerTimeString(this.#getPlayTime())}` 
				}, 100)
			}


		}


		// const audioPlayer = document.getElementById("audio_player")
		// audioPlayer.src = "https://sphinx.acast.com/p/acast/s/ftnewsbriefing/e/659761a50f650a0017c0bf70/media.mp3"
		// audioPlayer.play()
		const podcastPlayer = new PodcastPlayer()
		playButton.addEventListener("click",(event)=>{
			podcastPlayer.setSrc("https://sphinx.acast.com/p/acast/s/ftnewsbriefing/e/659761a50f650a0017c0bf70/media.mp3")
			//podcastPlayer.play()
		})
		

		//for setting scroll state
		meter.addEventListener("click",(event)=>{
			const totalWidth = meter.offsetWidth
			const clickedWidth = event.clientX
			const percentage = (clickedWidth/totalWidth)*100

				console.log(event)
				progressBar.style.width=`${percentage}%`
				podcastPlayer.setPlayerTime(percentage)
			})

		//***************AUXILIARY FUNCTIONS**************************
		function setVersion() {
			const docVersion = document.getElementById("version")
			docVersion.innerHTML = "V 0.0.5"

		}
	</script>

</body>

</html>